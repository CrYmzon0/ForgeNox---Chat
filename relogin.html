<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Wiederverbinden – Forge-Nox</title>
  <link rel="stylesheet" href="forge-nox-relogin.css">
</head>

<body class="fn-body">
  <div class="fn-relogin-card">
    <h1>Willkommen zurück</h1>
    <p id="fn-relogin-user"></p>

    <div class="fn-relogin-buttons">
      <button id="fn-relogin-continue">Weiter im Chat</button>
      <button id="fn-relogin-logout">Abmelden</button>
    </div>
  </div>

  <script>
    fetch("/me")
      .then(r => r.json())
      .then(data => {
        // nur wenn eingeloggt + away → ReLogin erlaubt
        if (!data.loggedIn || !data.away) {
          window.location.href = "/";
          return;
        }

        document.getElementById("fn-relogin-user").textContent =
          "Du warst zuletzt eingeloggt als " + data.username;

        // WICHTIG: als bestätigter ReLogin → /chat?relogin=1
        document.getElementById("fn-relogin-continue").onclick = () => {
          window.location.href = "/chat?relogin=1";
        };

        // Logout muss über Server gehen (httpOnly-Cookie!)
        document.getElementById("fn-relogin-logout").onclick = () => {
          window.location.href = "/logout";
        };
      })
      .catch(() => {
        window.location.href = "/";
      });
  </script>
</body>
</html>
