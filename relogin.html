<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Wiederverbinden – Forge-Nox</title>
  <link rel="stylesheet" href="forge-nox-relogin.css">
</head>

<body class="fn-body">
  <div class="fn-relogin-card">
    <h1>Willkommen zurück</h1>
    <p id="fn-relogin-user"></p>

    <div class="fn-relogin-buttons">
      <button id="fn-relogin-continue">Weiter im Chat</button>
      <button id="fn-relogin-logout">Abmelden</button>
    </div>
  </div>

  <script>
    fetch("/me")
      .then(r => r.json())
      .then(data => {
        // Nur wenn eingeloggt UND away → ReLogin erlaubt
        if (!data.loggedIn || !data.away) {
          window.location.href = "/";
          return;
        }

        document.getElementById("fn-relogin-user").textContent =
          "Du warst zuletzt eingeloggt als " + data.username;

        document.getElementById("fn-relogin-continue").onclick = () => {
          window.location.href = "/chat";
        };

        document.getElementById("fn-relogin-logout").onclick = () => {
          // Cookie invalidieren – Session ist serverseitig nach Timeout eh weg
          document.cookie = "sessionId=; Max-Age=0; path=/;";
          window.location.href = "/";
        };
      })
      .catch(() => {
        window.location.href = "/";
      });
  </script>
</body>
</html>
